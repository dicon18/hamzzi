var socket,isConnected=!1,playerName="",playerScale=2,oPlayerList=[],timerSec="00",timerMin=3,gameMulti={init:function(){socket=io(),game.stage.disableVisibilityChange=!0},create:function(){this.camera.flash("#000000"),this.blueScore=0,this.orangeScore=0,this.isPause=!1,""==playerName&&(playerName="플레이어"),this.cursors=game.input.keyboard.createCursorKeys(),this.kickButton=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),socket.on("connect",onConnected),socket.on("remove_player",onRemove_oPlayer),socket.on("create_oPlayer",onNew_oPlayer),socket.on("move_oPlayer",onMove_oPlayer),socket.on("move_player",onMove_player),socket.on("server_info",onServerInfo),socket.on("update_ball",onUpdateBall),socket.on("update_timer",onUpdateTimer),socket.on("blueGoal",onBlueGoal),socket.on("orangeGoal",onOrangeGoal),socket.on("waitPlayer",onWaitPlayer),socket.on("reset",onReset),socket.on("restart",onRestart),socket.on("destroy_winText",function(){gameMulti.winText.destroy()}),socket.on("destroy_goalText",function(){gameMulti.goalText.destroy()}),socket.on("destroy_waitText",function(){gameMulti.waitText.destroy()}),socket.on("sound_kick",function(){sfx_kick.play()}),this.background=game.add.image(0,0,bg_sprite[0]),this.ball=game.add.sprite(0,0,"spr_ball"),this.ball.anchor.set(.5),this.ball.scale.set(1.5),this.player=game.add.sprite(0,0,chr_sprite[chr_select]),this.player.anchor.set(.5),this.player.scale.set(playerScale),this.onPlayerName=game.add.text(0,0,playerName,{font:"bold 20px BMJUA",fill:"#ffffff"}),this.onPlayerName.anchor.set(.5),this.onPlayerName.stroke="#ffffff",this.onPlayerName.strokeThickness=3,this.onPlayerName.bringToTop(),this.isKick=!1,this.timerText=game.add.text(CANVAS_WIDTH/2,50,timerMin+" : "+timerSec,{font:"50px BMJUA",fill:"#000000"}),this.timerText.anchor.set(.5),this.timerText.stroke="#ffffff",this.timerText.strokeThickness=3,this.timerText.bringToTop(),this.scoreText=game.add.text(CANVAS_WIDTH/2,90,this.blueScore+" : "+this.orangeScore,{font:"30px BMJUA",fill:"#000000"}),this.scoreText.addColor("#4834d4",0),this.scoreText.addColor("#000000",2),this.scoreText.addColor("#e67e22",4),this.scoreText.anchor.set(.5),this.scoreText.stroke="#ffffff",this.scoreText.strokeThickness=3,this.scoreText.bringToTop(),console.log("Client started")},update:function(){if(isConnected){var e=game.input.keyboard.addKey(Phaser.Keyboard.D).isDown-game.input.keyboard.addKey(Phaser.Keyboard.A).isDown,t=game.input.keyboard.addKey(Phaser.Keyboard.S).isDown-game.input.keyboard.addKey(Phaser.Keyboard.W).isDown;0==e&&0==t||0!=this.isPause||socket.emit("player_move",{hspd:e,vspd:t}),this.kickButton.isDown&&socket.emit("player_kick"),this.kickButton.isDown||(this.isKick=!1),this.onPlayerName.x=this.player.x,this.onPlayerName.y=this.player.y-30;for(var a=0;a<oPlayerList.length;a++)oPlayerList[a].onPlayerName.x=oPlayerList[a].player.x,oPlayerList[a].onPlayerName.y=oPlayerList[a].player.y-30;this.scoreText.setText(blueScore+" : "+orangeScore),this.timerText.setText(timerMin+" : "+timerSec),0==timerMin&&"00"==timerSec&&0==this.isPause&&(blueScore>orangeScore&&(this.winText=game.add.text(CANVAS_WIDTH/2,game.world.centerY,"블루팀 승리",{font:"100px BMJUA",fill:"#4834d4"}),this.winText.anchor.set(.5),this.winText.stroke="#ffffff",this.winText.strokeThickness=3,this.winText.bringToTop(),this.isPause=!0),blueScore<orangeScore&&(this.winText=game.add.text(CANVAS_WIDTH/2,game.world.centerY,playerName_2+"오렌지팀 승리",{font:"100px BMJUA",fill:"#e67e22"}),this.winText.anchor.set(.5),this.winText.stroke="#ffffff",this.winText.strokeThickness=3,this.winText.bringToTop(),this.isPause=!0),blueScore==orangeScore&&(this.winText=game.add.text(CANVAS_WIDTH/2,game.world.centerY,"무승부",{font:"100px BMJUA",fill:"#000000"}),this.winText.stroke="#ffffff",this.winText.strokeThickness=3,this.winText.anchor.set(.5),this.winText.bringToTop(),this.isPause=!0),sfx_endWhistle.play())}}};function onConnected(){socket.emit("connected_player",{sprite:chr_sprite[chr_select],radius:gameMulti.player.width/2,scale:playerScale,speed:2,speedMax:15,kickPower:3,name:playerName}),isConnected=!0,console.log("Connected to server")}function onNew_oPlayer(e){var t=new Player(e.id,e.x,e.y,e.sprite,e.xdir,e.name,e.team);oPlayerList.push(t)}function onMove_oPlayer(e){var t=find_playerID(e.id);t&&(t.player.x=e.x,t.player.y=e.y,t.player.scale.x=e.xdir*playerScale)}function onMove_player(e){gameMulti.player.x=e.x,gameMulti.player.y=e.y,gameMulti.player.scale.x=e.xdir*playerScale}function onRemove_oPlayer(e){var t=find_playerID(e.id);t&&(t.player.destroy(),t.onPlayerName.destroy(),oPlayerList.splice(oPlayerList.indexOf(t),1))}function onServerInfo(e){gameMulti.background.loadTexture(bg_sprite[e.background_index]),"blue"==e.team&&(gameMulti.onPlayerName.fill="#4834d4"),"orange"==e.team&&(gameMulti.onPlayerName.fill="#e67e22"),orangeScore=e.orangeScore,blueScore=e.blueScore}function onUpdateBall(e){gameMulti.ball.x=e.x,gameMulti.ball.y=e.y,gameMulti.ball.angle=e.angle}function onUpdateTimer(e){timerSec=e.timerSec,timerMin=e.timerMin}function onBlueGoal(){gameMulti.goalText=game.add.text(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,"블루팀 득점",{font:"100px BMJUA",fill:"#4834d4",align:"center"}),gameMulti.goalText.anchor.set(.5),gameMulti.goalText.stroke="#ffffff",gameMulti.goalText.strokeThickness=3,gameMulti.goalText.bringToTop(),gameMulti.isPause=!0,sfx_cheer.play(),blueScore++}function onOrangeGoal(){gameMulti.goalText=game.add.text(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,"오렌지팀 득점",{font:"100px BMJUA",fill:"#e67e22",align:"center"}),gameMulti.goalText.anchor.set(.5),gameMulti.goalText.stroke="#ffffff",gameMulti.goalText.strokeThickness=3,gameMulti.goalText.bringToTop(),gameMulti.isPause=!0,sfx_cheer.play(),orangeScore++}function onWaitPlayer(){gameMulti.waitText=game.add.text(CANVAS_WIDTH/2,game.world.centerY,"다른 플레이어를 기다리는중입니다",{font:"60px BMJUA",fill:"#000000"}),gameMulti.waitText.stroke="#ffffff",gameMulti.waitText.strokeThickness=3,gameMulti.waitText.anchor.set(.5),gameMulti.waitText.bringToTop()}function onReset(){gameMulti.isPause=!1}function onRestart(e){gameMulti.camera.flash("#000000"),gameMulti.background.loadTexture(bg_sprite[e]),timerSec="00",timerMin=3,blueScore=0,orangeScore=0,gameMulti.isPause=!1,sfx_startWhistle.play()}function find_playerID(e){for(var t=0;t<oPlayerList.length;t++)if(oPlayerList[t].id==e)return oPlayerList[t]}var Player=function(e,t,a,o,i,r,s){if(this.id=e,this.player=game.add.sprite(t,a,o),this.player.anchor.setTo(.5,.5),this.player.scale.set(playerScale),this.player.scale.x=i*playerScale,"blue"==s)var n="#4834d4";if("orange"==s)n="#e67e22";this.onPlayerName=game.add.text(this.player.x,this.player.y-30,r,{font:"bold 20px BMJUA",fill:n}),this.onPlayerName.anchor.set(.5),this.onPlayerName.stroke="#ffffff",this.onPlayerName.strokeThickness=3,this.onPlayerName.bringToTop()};