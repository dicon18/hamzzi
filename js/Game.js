var maxSpeed,playerShootPower,maxDashSpeed,ball,ballMaxSpeed,ballScale,ballMass,playerName_1="",playerName_2="",playerScale_1=2,playerScale_2=2,playerAccSpeed=10,playerMaxSpeed_1=maxSpeed,playerMaxSpeed_2=maxSpeed,dashSpeed_1=maxDashSpeed,dashSpeed_2=maxDashSpeed,timerSec="00",timerMin=3,orangeScore=0,blueScore=0,Game={create:function(){this.camera.flash("#000000"),game.physics.startSystem(Phaser.Physics.P2JS),game.physics.p2.setImpactEvents(!0),game.physics.p2.restitution=.5,game.add.image(0,0,bg_sprite[bg_select]),this.cursors=game.input.keyboard.createCursorKeys(),this.kickButton_1=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),this.kickButton_2=game.input.keyboard.addKey(Phaser.Keyboard.ENTER),this.dashButton_1=game.input.keyboard.addKey(Phaser.Keyboard.M),this.dashButton_2=game.input.keyboard.addKey(Phaser.Keyboard.QUOTES),this.playerCollisionGroup=game.physics.p2.createCollisionGroup(),this.ballCollisionGroup=game.physics.p2.createCollisionGroup(),this.boxCollisionGroup=game.physics.p2.createCollisionGroup(),game.physics.p2.updateBoundsCollisionGroup(),this.isGoal=!1,this.isTimeOver=!1,game.time.events.add(3*Phaser.Timer.SECOND,this.startGame),this.isGameStart=!1,this.text_ready=game.add.text(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,"준비",{font:"100px BMJUA",fill:"#000000"}),this.text_ready.anchor.set(.5),this.text_ready.stroke="#ffffff",this.text_ready.strokeThickness=6,""==playerName_1&&(playerName_1="플레이어1"),""==playerName_2&&(playerName_2="플레이어2");var s=game.add.group();s.enableBody=!0,s.physicsBodyType=Phaser.Physics.P2JS;for(var t=0;t<228;t++)this.box=s.create(5*t+68,40,"spr_box"),this.box.alpha=0,this.box.body.static=!0,this.box.scale.set(1),this.box.body.mass=5,this.box.body.setCollisionGroup(this.boxCollisionGroup),this.box.body.collides(this.ballCollisionGroup),this.box=s.create(5*t+68,680,"spr_box"),this.box.alpha=0,this.box.body.static=!0,this.box.scale.set(1),this.box.body.mass=5,this.box.body.setCollisionGroup(this.boxCollisionGroup),this.box.body.collides(this.ballCollisionGroup);for(t=0;t<43;t++)this.box=s.create(67,5*t+40,"spr_box"),this.box.alpha=0,this.box.body.static=!0,this.box.scale.set(1),this.box.body.mass=5,this.box.body.setCollisionGroup(this.boxCollisionGroup),this.box.body.collides(this.ballCollisionGroup),this.box=s.create(1210,5*t+40,"spr_box"),this.box.alpha=0,this.box.body.static=!0,this.box.scale.set(1),this.box.body.mass=5,this.box.body.setCollisionGroup(this.boxCollisionGroup),this.box.body.collides(this.ballCollisionGroup);for(t=0;t<44;t++)this.box=s.create(67,5*t+465,"spr_box"),this.box.alpha=0,this.box.body.static=!0,this.box.scale.set(1),this.box.body.mass=5,this.box.body.setCollisionGroup(this.boxCollisionGroup),this.box.body.collides(this.ballCollisionGroup),this.box=s.create(1210,5*t+465,"spr_box"),this.box.alpha=0,this.box.body.static=!0,this.box.scale.set(1),this.box.body.mass=5,this.box.body.setCollisionGroup(this.boxCollisionGroup),this.box.body.collides(this.ballCollisionGroup);for(t=0;t<14;t++)this.box=s.create(5*t+3,250,"spr_box"),this.box.alpha=0,this.box.body.static=!0,this.box.scale.set(1),this.box.body.mass=5,this.box.body.setCollisionGroup(this.boxCollisionGroup),this.box.body.collides(this.ballCollisionGroup),this.box=s.create(5*t+1270-60,250,"spr_box"),this.box.alpha=0,this.box.body.static=!0,this.box.scale.set(1),this.box.body.mass=5,this.box.body.setCollisionGroup(this.boxCollisionGroup),this.box.body.collides(this.ballCollisionGroup),this.box=s.create(5*t+3,465,"spr_box"),this.box.alpha=0,this.box.body.static=!0,this.box.scale.set(1),this.box.body.mass=5,this.box.body.setCollisionGroup(this.boxCollisionGroup),this.box.body.collides(this.ballCollisionGroup),this.box=s.create(5*t+1270-60,465,"spr_box"),this.box.alpha=0,this.box.body.static=!0,this.box.scale.set(1),this.box.body.mass=5,this.box.body.setCollisionGroup(this.boxCollisionGroup),this.box.body.collides(this.ballCollisionGroup);for(t=0;t<44;t++)this.box=s.create(4,5*t+250,"spr_box"),this.box.alpha=0,this.box.body.static=!0,this.box.scale.set(1),this.box.body.mass=5,this.box.body.setCollisionGroup(this.boxCollisionGroup),this.box.body.collides(this.ballCollisionGroup),this.box=s.create(1276,5*t+250,"spr_box"),this.box.alpha=0,this.box.body.static=!0,this.box.scale.set(1),this.box.body.mass=5,this.box.body.setCollisionGroup(this.boxCollisionGroup),this.box.body.collides(this.ballCollisionGroup);this.player_1=game.add.sprite(game.world.centerX-400,game.world.centerY,chr_sprite[chr_select_1]),this.player_1.anchor.set(.5),game.physics.p2.enable(this.player_1,!1),this.player_1.body.mass=5,this.player_1.body.fixedRotation=!0,this.player_1.body.damping=.75,this.player_1.scale.set(playerScale_1),this.player_1.body.setCircle(this.player_1.width/2),this.player_1.body.setCollisionGroup(this.playerCollisionGroup),this.player_1.body.collides([this.ballCollisionGroup,this.playerCollisionGroup]),this.player_1.animations.add("stand",[0,1],10,!0),this.player_1.animations.add("walk",[2,3,4,5],15,!0),this.player_1.animations.add("win",[6],10,!0),this.player_1.animations.add("lose",[7,8],10,!0),this.playerHspd_1=1,this.isKick_1=!1,this.player_2=game.add.sprite(game.world.centerX+400,game.world.centerY,chr_sprite[chr_select_2]),this.player_2.anchor.set(.5),game.physics.p2.enable(this.player_2,!1),this.player_2.body.mass=5,this.player_2.body.fixedRotation=!0,this.player_2.body.damping=.75,this.player_2.scale.set(playerScale_2),this.player_2.body.setCircle(this.player_2.width/2),this.player_2.body.setCollisionGroup(this.playerCollisionGroup),this.player_2.body.collides([this.ballCollisionGroup,this.playerCollisionGroup]),this.player_2.animations.add("stand",[0,1],10,!0),this.player_2.animations.add("walk",[2,3,4,5],10,!0),this.player_2.animations.add("win",[6],10,!0),this.player_2.animations.add("lose",[7,8],10,!0),this.playerHspd_2=-1,this.isKick_2=!1,this.ball=game.add.sprite(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,"spr_ball"),this.ball.anchor.set(.5),game.physics.p2.enable(this.ball,!1),this.ball.body.mass=ballMass,this.ball.body.damping=.7,this.ball.body.fixedRotation=!1,this.ball.scale.set(ballScale),this.ball.body.setCircle(this.ball.width/2),this.ball.body.setCollisionGroup(this.ballCollisionGroup),this.ball.body.collides([this.playerCollisionGroup,this.boxCollisionGroup]),this.ball.scale.set(5*ballScale),this.ball.alpha=0,this.timerText=game.add.text(CANVAS_WIDTH/2,50,timerMin+" : "+timerSec,{font:"50px BMJUA",fill:"#000000"}),this.timerText.anchor.set(.5),this.timerText.stroke="#ffffff",this.timerText.strokeThickness=3,this.timer=game.time.create(!1),this.timer.loop(1e3,this.timerSecCnt,this),this.timer.start(),this.scoreText=game.add.text(CANVAS_WIDTH/2,90,blueScore+" : "+orangeScore,{font:"30px BMJUA",fill:"#000000"}),this.scoreText.addColor("#4834d4",0),this.scoreText.addColor("#000000",2),this.scoreText.addColor("#e67e22",4),this.scoreText.anchor.set(.5),this.scoreText.stroke="#ffffff",this.scoreText.strokeThickness=3,this.onPlayerName_1=game.add.text(this.player_1.body.x,this.player_1.body.y-30,playerName_1,{font:"bold 20px BMJUA",fill:"#4834d4"}),this.onPlayerName_1.anchor.set(.5),this.onPlayerName_1.stroke="#ffffff",this.onPlayerName_1.strokeThickness=3,this.onPlayerName_2=game.add.text(this.player_2.body.x,this.player_2.body.y-30,playerName_2,{font:"bold 20px BMJUA",fill:"#e67e22"}),this.onPlayerName_2.anchor.set(.5),this.onPlayerName_2.stroke="#ffffff",this.onPlayerName_2.strokeThickness=3,this.staminaBar_1=new HealthBar(this.game,{width:50,height:10,x:this.player_1.x,y:this.player_1.y+40,bg:{color:"#7f8c8d"},bar:{color:"#3c40c6"}}),this.stamina_1=100,this.staminaBar_1.setPercent(this.stamina_1),this.staminaBar_2=new HealthBar(this.game,{width:50,height:10,x:this.player_2.x,y:this.player_2.y+40,bg:{color:"#7f8c8d"},bar:{color:"#3c40c6"}}),this.stamina_2=100,this.staminaBar_2.setPercent(this.stamina_2),this.ef_kick_1=game.add.sprite(this.player_1.x,this.player_1.y,"ef_kick"),this.ef_kick_1.anchor.set(.5),this.ef_kick_1.width=100,this.ef_kick_1.height=100,this.ef_kick_1.animations.add("ef_kick",[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],15,!0),this.ef_kick_1.animations.play("ef_kick"),this.ef_kick_1.alpha=0,this.ef_kick_2=game.add.sprite(this.player_2.x,this.player_2.y,"ef_kick"),this.ef_kick_2.anchor.set(.5),this.ef_kick_2.width=100,this.ef_kick_2.height=100,this.ef_kick_2.animations.add("ef_kick",[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19],15,!0),this.ef_kick_2.animations.play("ef_kick"),this.ef_kick_2.alpha=0,this.player_1.bringToTop(),this.player_2.bringToTop(),this.onPlayerName_2.bringToTop(),this.onPlayerName_1.bringToTop(),this.timerText.bringToTop(),this.scoreText.bringToTop()},update:function(){this.isGameStart&&0==this.isTimeOver&&0==this.isGoal&&(this.playerHspd_1=game.input.keyboard.addKey(Phaser.Keyboard.D).isDown-game.input.keyboard.addKey(Phaser.Keyboard.A).isDown,this.player_1.body.velocity.x+=this.playerHspd_1*playerAccSpeed,this.playerVspd_1=game.input.keyboard.addKey(Phaser.Keyboard.S).isDown-game.input.keyboard.addKey(Phaser.Keyboard.W).isDown,this.player_1.body.velocity.y+=this.playerVspd_1*playerAccSpeed,this.playerHspd_2=this.cursors.right.isDown-this.cursors.left.isDown,this.player_2.body.velocity.x+=this.playerHspd_2*playerAccSpeed,this.playerVspd_2=this.cursors.down.isDown-this.cursors.up.isDown,this.player_2.body.velocity.y+=this.playerVspd_2*playerAccSpeed,Math.max(Math.abs(this.player_1.body.velocity.x),Math.abs(this.player_1.body.velocity.y))<10?this.player_1.animations.play("stand"):this.player_1.animations.play("walk"),Math.max(Math.abs(this.player_2.body.velocity.x),Math.abs(this.player_2.body.velocity.y))<10?this.player_2.animations.play("stand"):this.player_2.animations.play("walk")),this.player_1.body.velocity.x=game.math.clamp(this.player_1.body.velocity.x,-playerMaxSpeed_1,playerMaxSpeed_1),this.player_1.body.velocity.y=game.math.clamp(this.player_1.body.velocity.y,-playerMaxSpeed_1,playerMaxSpeed_1),this.player_2.body.velocity.x=game.math.clamp(this.player_2.body.velocity.x,-playerMaxSpeed_2,playerMaxSpeed_2),this.player_2.body.velocity.y=game.math.clamp(this.player_2.body.velocity.y,-playerMaxSpeed_2,playerMaxSpeed_2),this.onPlayerName_1.x=this.player_1.x,this.onPlayerName_1.y=this.player_1.y-30,this.onPlayerName_2.x=this.player_2.x,this.onPlayerName_2.y=this.player_2.y-30,this.ef_kick_1.x=this.player_1.x,this.ef_kick_1.y=this.player_1.y,this.ef_kick_2.x=this.player_2.x,this.ef_kick_2.y=this.player_2.y,this.kickButton_1.isDown&&0==this.isKick_1?this.isGameStart&&(this.ef_kick_1.alpha=1):this.ef_kick_1.alpha=0,this.kickButton_2.isDown&&0==this.isKick_2?this.isGameStart&&(this.ef_kick_2.alpha=1):this.ef_kick_2.alpha=0,0!=this.playerHspd_1&&(this.player_1.scale.x=this.playerHspd_1*playerScale_1),0!=this.playerHspd_2&&(this.player_2.scale.x=this.playerHspd_2*playerScale_1),this.staminaBar_1.setPosition(this.player_1.x,this.player_1.y+40),this.staminaBar_1.setPercent(this.stamina_1),this.staminaBar_2.setPosition(this.player_2.x,this.player_2.y+40),this.staminaBar_2.setPercent(this.stamina_2),this.stamina_1=game.math.clamp(this.stamina_1,0,100),this.stamina_2=game.math.clamp(this.stamina_2,0,100),this.dashButton_1.isDown&&this.isGameStart?(playerMaxSpeed_1=dashSpeed_1,this.stamina_1>0&&(this.stamina_1-=.5)):!this.dashButton_1.isDown&&this.isGameStart&&(playerMaxSpeed_1=maxSpeed,this.stamina_1<100&&setTimeout(()=>{this.stamina_1+=.5},3e3)),this.dashButton_2.isDown?(playerMaxSpeed_2=dashSpeed_2,this.stamina_2>0&&(this.cursors.up.isDown||this.cursors.left.isDown||this.cursors.down.isDown||this.cursors.right.isDown)&&Math.max(Math.abs(this.player_2.body.velocity.x),Math.abs(this.player_2.body.velocity.y))>10&&(this.stamina_2-=.5)):this.dashButton_1.isDown||(playerMaxSpeed_2=maxSpeed,this.stamina_2<100&&setTimeout(()=>{this.stamina_2+=.5},5e3)),this.stamina_1<=0?dashSpeed_1=maxSpeed:this.stamina_1>0&&(dashSpeed_1=maxDashSpeed),this.stamina_2<=0?dashSpeed_2=maxSpeed:this.stamina_2>0&&(dashSpeed_2=maxDashSpeed),Phaser.Rectangle.intersects(this.player_1.getBounds(),this.ball.getBounds())?this.kickButton_1.isDown&&0==this.isKick_1?(sfx_kick.play(),this.ball.body.angle=180*game.math.angleBetween(this.player_1.x,this.player_1.y,this.ball.x,this.ball.y)/Math.PI+90,this.ball.body.moveForward(playerShootPower),this.isKick_1=!0):this.kickButton_1.isDown||(this.isKick_1=!1):0!=Phaser.Rectangle.intersects(this.player_1.getBounds(),this.ball.getBounds())||this.kickButton_1.isDown||(this.isKick_1=!1),Phaser.Rectangle.intersects(this.player_2.getBounds(),this.ball.getBounds())?this.kickButton_2.isDown&&0==this.isKick_2?(sfx_kick.play(),this.ball.body.angle=180*game.math.angleBetween(this.player_2.x,this.player_2.y,this.ball.x,this.ball.y)/Math.PI+90,this.ball.body.moveForward(playerShootPower),this.isKick_2=!0):this.kickButton_2.isDown||(this.isKick_2=!1):0!=Phaser.Rectangle.intersects(this.player_2.getBounds(),this.ball.getBounds())||this.kickButton_2.isDown||(this.isKick_2=!1),this.isGameStart&&(this.ball.scale.x>ballScale&&(this.ball.scale.x+.1>ballScale?(this.ball.scale.x-=.1,this.ball.scale.y-=.1):(this.ball.scale.x=ballScale,this.ball.scale.y=ballScale)),this.ball.alpha=Math.min(1,ballScale/this.ball.scale.x)),this.ball.body.velocity.x=game.math.clamp(this.ball.body.velocity.x,-ballMaxSpeed,ballMaxSpeed),this.ball.body.velocity.y=game.math.clamp(this.ball.body.velocity.y,-ballMaxSpeed,ballMaxSpeed),this.ball.body.angle+=(Math.abs(this.ball.body.velocity.x)>Math.abs(this.ball.body.velocity.y)?this.ball.body.velocity.x:this.ball.body.velocity.y)/20,0==this.isGoal&&0==this.isTimeOver&&(this.ball.body.x>=1232.9&&this.ball.body.y>=252.5&&this.ball.body.y<=447.6&&(blueScore++,sfx_cheer.play(),this.player_1.animations.play("win"),this.player_2.animations.play("lose"),this.blueGoalText(),this.isGoal=!0,this.timer.stop(),this.scoreText.stroke="#ffffff",this.scoreText.strokeThickness=3,game.time.events.add(6*Phaser.Timer.SECOND,this.restartGame)),this.ball.body.x<=48.3&&this.ball.body.y>=252.5&&this.ball.body.y<=447.6&&(orangeScore++,sfx_cheer.play(),this.player_1.animations.play("lose"),this.player_2.animations.play("win"),this.orangeGoalText(),this.isGoal=!0,this.timer.stop(),game.time.events.add(6*Phaser.Timer.SECOND,this.restartGame))),0==timerMin&&"00"==timerSec&&0==this.isTimeOver&&(blueScore>orangeScore&&(this.BlueWinText=game.add.text(CANVAS_WIDTH/2,game.world.centerY,playerName_1+"팀 승리",{font:"100px BMJUA",fill:"#4834d4"}),this.BlueWinText.anchor.set(.5),this.BlueWinText.stroke="#ffffff",this.BlueWinText.strokeThickness=3,this.player_1.animations.play("win"),this.player_2.animations.play("lose"),this.BlueWinText.bringToTop()),blueScore<orangeScore&&(this.OrangeWinText=game.add.text(CANVAS_WIDTH/2,game.world.centerY,playerName_2+"팀 승리",{font:"100px BMJUA",fill:"#e67e22"}),this.OrangeWinText.anchor.set(.5),this.OrangeWinText.stroke="#ffffff",this.OrangeWinText.strokeThickness=3,this.player_1.animations.play("lose"),this.player_2.animations.play("win"),this.OrangeWinText.bringToTop()),blueScore==orangeScore&&(this.drawText=game.add.text(CANVAS_WIDTH/2,game.world.centerY,"무승부",{font:"100px BMJUA",fill:"#000000"}),this.drawText.stroke="#ffffff",this.drawText.strokeThickness=3,this.drawText.anchor.set(.5),this.player_1.animations.play("stand"),this.player_2.animations.play("stand"),this.drawText.bringToTop()),this.timer.stop(),this.isTimeOver=!0,sfx_endWhistle.play(),game.time.events.add(5*Phaser.Timer.SECOND,this.resetGame)),this.timerText.setText(timerMin+" : "+timerSec),this.scoreText.setText(blueScore+" : "+orangeScore)},startGame:function(){Game.isGameStart=!0,Game.text_ready.destroy(),sfx_startWhistle.play()},timerSecCnt:function(){Game.isGameStart&&(0==--timerSec&&(timerSec="00"),timerSec<0&&(timerMin--,timerSec=59))},orangeGoalText:function(){this.text=game.add.text(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,playerName_2+"팀 득점",{font:"100px BMJUA",fill:"#e67e22",align:"center"}),this.text.anchor.set(.5),this.text.stroke="#ffffff",this.text.strokeThickness=3,this.text.bringToTop()},blueGoalText:function(){this.text=game.add.text(CANVAS_WIDTH/2,CANVAS_HEIGHT/2,playerName_1+"팀 득점",{font:"100px BMJUA",fill:"#4834d4",align:"center"}),this.text.anchor.set(.5),this.text.stroke="#ffffff",this.text.strokeThickness=3,this.text.bringToTop()},restartGame:function(){game.state.restart()},resetGame:function(){timerSec="00",timerMin=3,orangeScore=0,blueScore=0,game.state.start("singleCustom")}};